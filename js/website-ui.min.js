angular.module("ui.website",["ui.website.player","ui.website.dialog"]);
angular.module("ui.website.dialog",["ui.website.dialog.service","ui.website.dialog.directives"]);
angular.module("ui.website.dialog.directives",[]).directive("walert",["$timeout",function(n){return{restrict:"EA",transclude:!0,templateUrl:"template/alert.html",compile:function(t,i,l){function o(){t.children().removeClass("in"),n(function(){t.hide()},150)}return t.show(),{pre:angular.noop,post:function(t,i,l,d){i.find("div.modal-footer").find("button").unbind("click").bind("click",function(n){o()}),i.find("button.close").unbind("click").bind("click",function(n){o()}),n(function(){i.children().addClass("in")},0)}}}}}]).directive("wconfirm",["$timeout",function(n){return{restrict:"EA",transclude:!0,templateUrl:"template/confirm.html",compile:function(t,i,l){function o(){t.children().removeClass("in"),n(function(){t.hide()},150)}return t.show(),{pre:angular.noop,post:function(t,i,l,d){var c=i.find("div.modal-footer").find("button");angular.element(c[0]).unbind("click").bind("click",function(n){t.ok(),o()}),angular.element(c[1]).unbind("click").bind("click",function(n){o()}),i.find("button.close").unbind("click").bind("click",function(n){o()}),n(function(){i.children().addClass("in")},0)}}}}}]).directive("wprompt",["$timeout",function(n){return{restrict:"EA",transclude:!0,templateUrl:"template/confirm.html",compile:function(t,i,l){function o(t,i,l,o){var c=i.find("div.modal-footer").find("button");angular.element(c[0]).unbind("click").bind("click",function(n){if(t.option.ajax)t.option.callback(i.find("input").val(),function(n){t.option.success&&t.option.success(n),d()},function(n){t.option.error&&t.option.error(n)});else{var l=t.option.callback(i.find("input").val());"boolean"==typeof l&&l||1===l?d():i.find("input").parent().addClass("has-error").addClass("has-feedback")}}),angular.element(c[1]).unbind("click").bind("click",function(n){d()}),i.find("button.close").unbind("click").bind("click",function(n){d()}),n(function(){i.children().addClass("in")},0)}function d(){t.children().removeClass("in"),n(function(){t.hide()},150)}return t.show(),o}}}]).run(["$templateCache",function(n){n.put("template/alert.html",'<div class="modal fade" style="display:block;"><div class="modal-dialog modal-sm"><div class="modal-content"><div class="modal-header"><div class="row"><div class="col-md-9 col-lg-9">{{title}}</div><div class="col-md-3 col-lg-3"><button type="button" class="close"><span>×</span></button></div></div></div><div class="modal-body text-center"><p><div ng-transclude></div></p></div><div class="modal-footer"><button type="button" class="btn btn-orz">确定</button></div></div></div></div><div class="modal-backdrop fade"></div>'),n.put("template/confirm.html",'<div class="modal fade" style="display:block;"><div class="modal-dialog modal-sm"><div class="modal-content"><div class="modal-header"><div class="row"><div class="col-md-9 col-lg-9">{{title}}</div><div class="col-md-3 col-lg-3"><button type="button" class="close"><span>×</span></button></div></div></div><div class="modal-body text-center"><p><div ng-transclude></div></p></div><div class="modal-footer"> <button type="button" class="btn btn-orz">是</button> <button type="button" class="btn btn-default btn-large" >否</button></div></div></div></div><div class="modal-backdrop fade"></div>')}]);
angular.module("ui.website.dialog.service",[]).factory("DialogService",["$document","$compile","$rootScope",function(t,e,n){return{alert:function(l,i){var r=t.find("walert");0==r.length?(r=angular.element('<walert title="'+i+'">'+l+"</walert>"),t.find("body").append(r)):r.html(l);var o=n.$new(!1);i||(i="警告"),o.title=i,e(r)(o)},confirm:function(l,i,r){var o=t.find("wconfirm");0==o.length?(o=angular.element('<wconfirm title="'+r+'" >'+l+"</wconfirm>"),t.find("body").append(o)):(o.html(l),o.data("success",i));var a=n.$new(!1);r||(r="请确认"),a.title=r,a.ok=i,e(o)(a)},prompt:function(l){var i=t.find("wprompt");l||(l={},l.textType="text"),l.title||(l.title="请输入"),0==i.length?(i=angular.element('<wprompt title="'+l.title+'"><input type="'+l.textType+'" class="form-control" style="width: 70%; margin-left: 15%"/></wprompt>'),t.find("body").append(i)):i.html('<input type="'+l.textType+'" class="form-control" style="width: 70%; margin-left: 15%"/>');var r=n.$new(!1);r.option=l,r.title=l.title,e(i)(r)}}}]);
angular.module("ui.website.player",[]).controller("MusicPlayerCtrl",["$scope",function(e){e.mode="order";var t=e.currentIndex=0;if(e.volume=100,e.autoplay=!0,e.isPlaying=!0,e.list=function(){return e.list}(),angular.isArray(e.list)&&0!=e.list.length)e.currentMusic=e.list[t];else{var r={};r.url="",r.title="",r.artist="",r.special="",e.currentMusic=r}}]).directive("musicplayer",["$document","MusicPlayerService",function(e,t){function r(e){i=setInterval(function(){a+=2,a>=360&&(a=0),e.style.cssText="-webkit-transform:rotate("+a+"deg);-moz-transform:rotate("+a+"deg);-o-transform:rotate("+a+"deg);transform:rotate("+a+"deg)"},50)}var i,a=0,l=function(a,l,n,u){var c=new Audio(a.currentMusic.url);l.append(c);var s=e[0].getElementById("duration"),o=e[0].getElementById("volume"),d=e[0].getElementById("nextSong"),v=e[0].getElementsByName("play"),m=e[0].getElementById("music_img"),p=s.offsetWidth;angular.element(o).on("click",function(e){console.log(e.offsetX),c.volume=e.offsetX/this.offsetWidth,a.$apply(function(){a.volume=Math.round(100*this.volume)}.bind(c))}),angular.element(d).on("click",function(e){a.$apply(function(){a.currentMusic=t.getNext(a)})}),a.$watch("currentMusic",function(e,t){c.src=e.url}),angular.forEach(v,function(e,t){angular.element(e).on("click",function(e){var t=!0;c.paused?(c.play(),r(m),t=!0):(c.pause(),i&&(clearInterval(i),i=null),t=!1),a.$apply(function(){a.isPlaying=t})})});var f=function(e){var l=this;a.loaded=!0;var n=this.duration,u=Math.floor(n/60),o=Math.ceil(n-60*u);"number"==typeof a.volume&&(this.volume=a.volume/100),a.$apply(function(){"number"!=typeof a.volume&&(a.volume=Math.round(100*Math.random()))}.bind(this)),angular.element(s).on("click",function(e){console.log(e.offsetX);var t=Math.ceil(e.offsetX/p*100),r=n*(e.offsetX/p);l.currentTime=r,a.$apply(function(){a.currentMusic.currentPlayDuration=t})});var d=function(e){var t=this.currentTime,r=Math.floor(t/60),i=Math.ceil(t-60*r);60==i&&(r++,i=0);var l=r+":"+(10>i?"0"+i:i),n=this.duration,u=Math.ceil(t/n*100);setTimeout(function(){a.$apply(function(){a.currentMusic.currentPlayDuration=u,a.currentMusic.time=l})},0)};c.addEventListener("timeupdate",d,!0);var v=!0;a.autoplay?(c.play(),v=!0,i||r(m)):v=!1,a.$apply(function(){a.isPlaying=v}),c.addEventListener("ended",function(){a.$apply(function(){a.currentMusic=t.getNext(a)})},!0)};c.addEventListener("canplaythrough",f,!0)};return{restrict:"E",scope:{list:"="},controller:"MusicPlayerCtrl",compile:function(e,t,r){return l},templateUrl:"template/musicplayer.html",replace:!0}}]).factory("MusicPlayerService",function(){return{getNext:function(e){var t=e.list,r=e.mode;if(!angular.isArray(t)||0==t.length)return null;if(1==t.length)return t[0];var i=t.length;switch(r.toLowerCase().trim()){case"random":e.currentIndex=Math.ceil(Math.random()*i)-1;break;case"order":e.currentIndex++,e.currentIndex>=i&&(e.currentIndex=0)}return t[e.currentIndex]}}}).run(["$templateCache",function(e){e.put("template/musicplayer.html",'<div><div class="player-panel"><div class="row"><div class="col-md-4"><div class="music-img" id = "music_img"></div><div ng-class="isPlaying ? \'pause-ab ctrl\' : \'play-ab ctrl\'" name="play"></div></div><div class="col-md-8"><div class="">标题:{{currentMusic.title}}</div><div><div class=" ">歌手:{{currentMusic.artist}}</div><div class=" ">专辑:{{currentMusic.special}}</div></div><div><div class="progress duration" id="duration"><div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100" style="width: {{currentMusic.currentPlayDuration}}%"></div></div><div style="float: left;margin-left:5px;">{{currentMusic.time}}</div><ul style="clear:both;"><li ng-class="isPlaying ? \'pause ctrl\' : \'play ctrl\'" name="play"></li><li class="ctrl next" id="nextSong"></li><li class="ctrl ctrl-sm volume"></li><li><div class="progress volume-bar" id="volume"><div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100" style="width: {{volume}}%"></div></div></li><li style="margin-top: 6px;margin-left: 5px;">{{volume}}%</li></ul></div></div></div></div></div>')}]);